--Ticket Type Sales Report

ACCEPT ticket_type_1 CHAR PROMPT 'Enter First Ticket Type (TT001 to TT004): '
ACCEPT ticket_type_2 CHAR PROMPT 'Enter Second Ticket Type (TT001 to TT004): '

COLUMN current_date NEW_VALUE report_date
SELECT TO_CHAR(SYSDATE, 'DD-MON-YYYY') AS current_date FROM DUAL;

SET COLSEP '|';
SET LINESIZE 100;
SET PAGESIZE 50;

COLUMN TICKET_TYPE_ID HEADING 'Ticket Type ID' FORMAT A10
COLUMN TICKET_TYPE HEADING 'Ticket Type' FORMAT A20
COLUMN SOLD_COUNT HEADING 'Tickets Sold' FORMAT 9999

TTITLE LEFT 'Ticket Type Sales Report' CENTER 'Date: ' report_date

BREAK ON REPORT SKIP PAGE;

SELECT 
  t.TICKET_TYPE_ID, 
  t.TICKET_TYPE, 
  COUNT(e.TICKET_ID) AS SOLD_COUNT
FROM 
  ticket_type_3nf t
LEFT JOIN 
  entry_ticket_3nf e
  ON t.TICKET_TYPE_ID = e.TICKET_TYPE_ID
WHERE 
  t.TICKET_TYPE_ID IN ('&ticket_type_1', '&ticket_type_2')
GROUP BY 
  t.TICKET_TYPE_ID, 
  t.TICKET_TYPE;

COMPUTE SUM OF SOLD_COUNT ON REPORT;

--Maintenance Status Count in Enclosures

ACCEPT maintenance_status CHAR PROMPT 'Enter Maintenance Status (In Progress, Pending, or Completed): '

COLUMN current_date NEW_VALUE report_date
SELECT TO_CHAR(SYSDATE, 'DD-MON-YYYY') AS current_date FROM DUAL;

SET COLSEP '|';
SET LINESIZE 100;
SET PAGESIZE 50;

COLUMN ENCLOSURE_ID HEADING 'Enclosure ID' FORMAT A15
COLUMN CAPACITY HEADING 'Capacity' FORMAT 999
COLUMN ENVIRONMENT_TYPE HEADING 'Environment' FORMAT A20
COLUMN COUNT HEADING 'Maintenance Count' FORMAT 9999

TTITLE LEFT 'Maintenance Status Count in Enclosures' CENTER 'Date: ' report_date

BREAK ON REPORT SKIP PAGE;

SELECT
  e.ENCLOSURE_ID,
  e.CAPACITY,
  e.ENVIRONMENT_TYPE,
  COUNT(m.MAINTENANCE_ID) AS COUNT
FROM
  ENCLOSURE e
LEFT JOIN
  MAINTENANCE m
    ON e.ENCLOSURE_ID = m.ENCLOSURE_ID
    AND UPPER(m.STATUS) = UPPER('&maintenance_status') 
GROUP BY
  e.ENCLOSURE_ID,
  e.CAPACITY,
  e.ENVIRONMENT_TYPE;

COMPUTE SUM OF COUNT ON REPORT;



SET PAGESIZE 20
SET LINESIZE 120
SET FEEDBACK OFF
SET COLSEP '|'

--Total Revenue by Ticket Type 

ACCEPT ticket_type CHAR PROMPT 'Enter Ticket Type (TT001 to TT004): '

COLUMN current_date NEW_VALUE report_date
SELECT TO_CHAR(SYSDATE, 'DD-MON-YYYY') AS current_date FROM DUAL;

COLUMN TICKET_TYPE HEADING 'Ticket Type' FORMAT A20
COLUMN TICKET_PRICE HEADING 'Ticket Price' FORMAT 999
COLUMN SOLD_COUNT HEADING 'Tickets Sold' FORMAT 9999
COLUMN REVENUE HEADING 'Revenue' FORMAT 99999

TTITLE LEFT 'Total Revenue by Ticket Type' CENTER 'Date: ' report_date
BREAK ON REPORT SKIP PAGE
COMPUTE SUM OF REVENUE ON REPORT

SELECT 
  t.TICKET_TYPE_ID, 
  t.TICKET_TYPE, 
  t.TICKET_PRICE, 
  COUNT(e.TICKET_ID) AS SOLD_COUNT, 
  (COUNT(e.TICKET_ID) * t.TICKET_PRICE) AS REVENUE
FROM 
  TICKET_TYPE_3NF t
LEFT JOIN 
  ENTRY_TICKET_3NF e
  ON t.TICKET_TYPE_ID = e.TICKET_TYPE_ID 
WHERE 
  t.TICKET_TYPE_ID = '&ticket_type'
GROUP BY 
  t.TICKET_TYPE_ID, 
  t.TICKET_TYPE, 
  t.TICKET_PRICE;

SELECT 'Ad-hoc report generated by user | RDS1S2G2 | GROUP 4' AS FOOTER FROM DUAL;
